FROM node:alpine

MAINTAINER Gayatri Tagade "gayatri.tagade@ge.com"

ENV SERVICE_BRANCH=v1beta
ENV ENV=v1beta.sendai.1080

WORKDIR /build

ARG CF_USER
ARG CF_PWD 
ARG EC_APP_NAME
ARG EC_SERVICE_HOST_SUB_DOMAIN
ARG PROXY_URL
ARG EC_REV
ARG BUILD_NUMBER
ARG PROJECT_NAME
ARG ADMIN_USR
ARG ADMIN_PWD
ARG ZAC_UAA
ARG ZAC_URL
ARG ZAC_SERVICE_ID
ARG ZAC_CLIENT_ID
ARG ZAC_CLIENT_SECRET
ARG NUREGO_FEATURE_ID
ARG NUREGO_API_KEY
ARG NR_KEY
ARG NUREGO_TKN_INS
ARG NUREGO_TKN_PWD
ARG NUREGO_TKN_USR
ARG NUREGO_USAGE_FEATURE_ID

ARG NUREGO_ENDPOINT
ARG NUREGO_TKN_URL

COPY ./ec-px-service /build/ec-px-service

CMD chmod 755 ec-px-service/build.sh
CMD sh ./ec-px-service/build.sh -app $EC_APP_NAME -host $EC_SERVICE_HOST_SUB_DOMAIN \
-p $PROXY_URL -r $EC_REV \
-b $BUILD_NUMBER -e $PROJECT_NAME \
-ecadm $ADMIN_USR -ecpwd $ADMIN_PWD \
-zactokenurl $ZAC_UAA \
-zacurl $ZAC_URL \
-zacsvcid $ZAC_SERVICE_ID \
-zaccid $ZAC_CLIENT_ID \
-zaccscrt $ZAC_CLIENT_SECRET \
-nrgfeatrid $NUREGO_FEATURE_ID \
-nrgkey $NUREGO_API_KEY \
-newrelickey $NR_KEY
